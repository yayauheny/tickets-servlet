# Tickets - Clevertec

### О приложении
Приложение написано с использованием сервлетов, и представляет собой систему учета товаров и печати чеков.
Существует 2 роли - ADMIN/USER, где ADMIN может редактировать и удалять товары, карты, пользователей, а USER - 
выбирать товары к покупке и получать чек в виде PDF-файла. 
Чек считается с учетом скидок, если товар помечен как isDiscount = true, то скидки по нему считаются (задается количество товаров в константах,
после которых применяется скидка в 20 процентов от всей группы товаров, т.е если DISCOUNT_AFTER в классе Constants = 5, при покупке любого товара в количестве >=5, скидка по всем товарам данной категории 20% + общая скидка от всех покупок в размере скидки самой discount_card)

В проекте используются JSP, Gradle, Java 17, PostgreSQL, Lombok, JUnit5 (Тесты под сервлеты не переписаны, только под консольный вариант)
### Особенности реализации
- Присутствие Cache (кеширование всех сущностей для CRUD операций, тип = LRU/LFU (конфигурация в файле cache.yml) и аннотации для нее (@Cached)
  Находится в папке /service/cache и сам CachingDaoInvocationHandler в /service/proxy
- Большая часть вспомогательного кода (SQL-запросы, методы для работы с Servlet и тп) 
  Находится в /util
- Присутствие миграции, но она не работает (т.к не накатывалась при запуске, а только кидала ошибки по поиску нужных парсеров, удалил ее настройку из build.gradle)
- Номер чека считается по количеству посетителей, т.е константа INCREMENTED_CASHIER_NUMBER, которая добавляется в чек

### Инструкция по запуску
Для web:
- Запустить проект используя tomcat, проставив в war сгенерированный gradle war (exploded)
- Ввести в адресную строку http://localhost:8080/auth - при регистрации ввести существующий id карты (discount_card) - иначе кинет ошибку
Для console:
- Запустить TicketRunner
- Ввести с консоли данные в формате id-quantity id-quantity card-cardID , где id - id товара,  quantity - количество товара,
cardId - id скидочной карты

### Что мог исправить но не успел
- Настроить правильно миграцию
- Переписать ReceiptBuilder с использованием паттерна Декортатор
- Внести дополнительные сущности (например Чек - который имеет поля date, cashierNumber, и тп) для упрощения работы с чеком и форматирования в PDF
- Подредактировать БД, (неправильная связь с таблицами + удалить discount_card у users и добавить user_id в discount_card таблицу, сделать таблицу список_покупок)
- Возможно дописать DTO
- Переписать все на Spring :)



